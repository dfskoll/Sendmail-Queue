#!/usr/bin/perl -w
use strict;
use warnings;

my $sender;
while(my $arg = shift @ARGV) {
	last if $arg =~ /^--$/;

	if( $arg =~ /^-f(.*)/ ) {
		$sender = $1;
	}
}

my @recipients = @ARGV;

my $data = do { local $/; <STDIN> };

use Sendmail::Queue;

# FIXME: This queue directory is Debian-specific.
# FUTURE: Do we want to try the common client mqueue
# locations to make it work on more distros?
my $queue = Sendmail::Queue->new({
	queue_directory => '/var/spool/mqueue-client',
});

my $qid = $queue->queue_message({
	sender => $sender,
	recipients => \@recipients,
	data => $data,
});

print "Queued as $qid\n";
